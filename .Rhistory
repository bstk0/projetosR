is.data.frame(tbls_lsfe[[1]])
# ajusta dataframe inicial (CORE)
tbls_datafe <- tbls_lsfe[[1]]
is.data.frame(tbls_datafe)
head(tbls_datafe, 4)
#dfSetorDeParaA <- read.df(csvPath, "csv", header = "true", inferSchema = "true", na.strings = "NA")
dfCarteira <- read.csv(csvPath)
csvPath <- 'CARTEIRA-2023-08-30.csv'
#dfSetorDeParaA <- read.df(csvPath, "csv", header = "true", inferSchema = "true", na.strings = "NA")
dfCarteira <- read.csv(csvPath)
View(dfCarteira)
# agregar por ação ...
# Group by count using R Base aggregate()
agg_ACAO <- aggregate(dfCarteira$ACAO, by=list(dfCarteira$ACAO), FUN=length)
View(agg_ACAO)
# agregar por ação ...
# Group by count using R Base aggregate()
agg_ACAO <- aggregate(dfCarteira$ACAO, dfCarteira$QTDE, dfCarteira$TOTAL.OP,
by=list(dfCarteira$ACAO), FUN=length)
agg_ACAO <- aggregate(dfCarteira$ACAO,
by=list(dfCarteira$ACAO, dfCarteira$QTDE, dfCarteira$TOTAL.OP), FUN=length)
View(agg_ACAO)
summarise(dfCarteira)
View(dfCarteira)
View(dfCarteira)
dfCarteira %>%
group_by(ACAO) %>%
summarise(ValorTOTAL = sum(TOTAL.OP),
QTDE       = SUM(QTDE)  )
library(dplyr)
dfCarteira %>%
group_by(ACAO) %>%
summarise(ValorTOTAL = sum(TOTAL.OP),
QTDE       = SUM(QTDE)  )
dfCarteira %>%
dfCarteira %>%
group_by(ACAO) %>%
summarise(ValorTOTAL = sum(TOTAL.OP)) %>%
summarise(QTDE       = SUM(QTDE)  )
dfCarteira %>%
group_by(ACAO) %>%
summarise(across(everything(), list(mean)))
dfCarteira %>%
group_by(ACAO) %>%
summarise(across(everything(), list(sum)))
dfCarteira1 <- select(dfCarteira, 'ACAO','QTDE','TOTAL.OP' )
View(dfCarteira1)
dfCarteira1 %>%
group_by(ACAO) %>%
summarise(across(everything(), list(sum)))
dfCarteira1 %>%
group_by(ACAO) %>%
summarise(across(everything(), list(mean)))
dfCarteira1 %>%
group_by(ACAO) %>%
summarise(across(everything(), sum, na.rm = TRUE), .groups = 'drop')
dfCarteira1 %>%
group_by(ACAO) %>%
summarise(across(everything(), sum, na.rm = TRUE), .groups = 'drop')
dfCarteira1 %>%
group_by(ACAO) %>%
summarise(across(c(QTDE, TOTAL.OP), sum))
# ---
virgulaToValor <- function(str) {
novoValor <- gsub("[.]","",str)
novoValor <- gsub("[,]",".",novoValor)
novoValor <- as.numeric(novoValor)
return(novoValor)
}
dfCarteira1$TOTAL.OP <- virgulaToValor(dfCarteira1$TOTAL.OP)
dfCarteira1 %>%
group_by(ACAO) %>%
summarise(across(c(QTDE, TOTAL.OP), sum))
sum(dfCarteira1$TOTAL.OP[dfCarteira1$ACAO == "HABT11"],)
sum(dfCarteira1$TOTAL.OP[dfCarteira1$ACAO == "HABT11",])
dfCarteira1[dfCarteira1$ACAO == "HABT11",]
dfCarteira2 <- dfCarteira1 %>%
group_by(ACAO) %>%
summarise(across(c(QTDE, TOTAL.OP), sum))
View(dfCarteira2)
dfCarteira1[dfCarteira1$ACAO == "HABT11",]
dfCarteira1[dfCarteira1$ACAO == "VSLH11",]
# Valor Atual da VSLH11
tbls_datafe$`Preço Atual (R$)`[tbls_datafe$Fundos == "HABT11",]
# Valor Atual da VSLH11
tbls_datafe[tbls_datafe$Fundos == "HABT11",]
# Valor Atual da VSLH11
View(tbls_datafe[tbls_datafe$Fundos == "HABT11",])
# Valor Atual da VSLH11
View(tbls_datafe[tbls_datafe$Fundos == "VSLH11",])
dfCarteira1[dfCarteira1$ACAO == "VSLH11",]
dfCarteira2[dfCarteira1$ACAO == "VSLH11",]
dfCarteira2[dfCarteira2$ACAO == "VSLH11",]
summarise(dfCarteira)
tbls_datafe[tbls_datafe$Fundos == "VSLH11",tbls_datafe$`Preço Atual (R$)`]
tbls_backup <- tbls_datafe
tbls_datafe[`Preço Atual (R$)`][tbls_datafe$Fundos == "VSLH11",]
tbls_datafe[`Preço Atual (R$)`] %>%
tbls_datafe[tbls_datafe$Fundos == "VSLH11",]
tbls_datafe$`Preço Atual (R$)` %>%
tbls_datafe[tbls_datafe$Fundos == "VSLH11",]
tbls_datafe$`Preço Atual (R$)`[Fundos == "VSLH11",]
tbls_datafe$`Preço Atual (R$)`[tbls_datafe$Fundos == "VSLH11",]
tbls_datafe %>%
filter(Fundos == "VSLH11" == 1) %>%
tbls_datafe %>%
filter(Fundos == "VSLH11") %>%
select_at(`Preço Atual (R$)`)
tbls_datafe %>%
filter(Fundos == "VSLH11") %>%
select_at(vars(`Preço Atual (R$)`))
# Percentual das ações por valor
dfCarteira2 %>%
group_by(ACAO) %>%
mutate(percent = TOTAL.OP/sum(TOTAL.OP))
View(dfCarteira2)
dfCarteira2 %>%
group_by(ACAO) %>%
mutate(percent = TOTAL.OP/sum(TOTAL.OP))
totalGeral <- sum(dfCarteira2$TOTAL.OP)
totalGeral
# Percentual das ações por valor
dfCarteira2 %>%
mutate(percent = TOTAL.OP/totalGeral)
View(dfCarteira2)
# Percentual das ações por valor
dfCarteira2 <- dfCarteira2 %>%
mutate(percent = TOTAL.OP/totalGeral)
# Percentual das ações por valor
dfCarteira2 <- dfCarteira2 %>%
mutate(percent = (TOTAL.OP/totalGeral)*100)
sum(dfCarteira2$percent)
pacotes <- c("seleniumPipes","RSelenium","rvest","openxlsx","XML",
"dplyr","kableExtra")
#pacotes <- c("rvest","tidyverse""writexl")
if(sum(as.numeric(!pacotes %in% installed.packages())) != 0){
instalador <- pacotes[!pacotes %in% installed.packages()]
for(i in 1:length(instalador)) {
install.packages(instalador, dependencies = T)
break()}
sapply(pacotes, require, character = T)
} else {
sapply(pacotes, require, character = T)
}
virgulaToValor <- function(str) {
novoValor <- gsub("[.]","",str)
novoValor <- gsub("[,]",".",novoValor)
novoValor <- as.numeric(novoValor)
return(novoValor)
}
#----
# filename <- paste0("R-out_", format(Sys.Date(), "%d-%m-%Y"), ".html")
filename <- "C://BISTERCO//MBA//TCC//R-out_30-08-2023.html"
fiife <- read_html(filename,encoding = "UTF-8")
tblsfe <- html_nodes(fiife, "table")
tblsfe[1]
tbls_lsfe <- fiife %>%
html_nodes("table") %>%
.[1] %>%
html_table(fill = TRUE)
head(tbls_lsfe[[1]], 4)
str(tbls_lsfe)
head(tbls_lsfe[[1]], 4)
# verifica se é um dataframe
is.data.frame(tbls_lsfe[[1]])
# ajusta dataframe inicial (CORE)
tbls_datafe <- tbls_lsfe[[1]]
is.data.frame(tbls_datafe)
head(tbls_datafe, 4)
# LENDO MINHA CARTEIRA -------
#
csvPath <- 'CARTEIRA-2023-08-30.csv'
#dfSetorDeParaA <- read.df(csvPath, "csv", header = "true", inferSchema = "true", na.strings = "NA")
dfCarteira <- read.csv(csvPath)
# agregar por ação ...
# Group by count using R Base aggregate()
agg_ACAO <- aggregate(dfCarteira$ACAO, dfCarteira$QTDE, dfCarteira$TOTAL.OP,
by=list(dfCarteira$ACAO), FUN=length)
agg_ACAO <- aggregate(dfCarteira$ACAO,
by=list(dfCarteira$ACAO, dfCarteira$QTDE, dfCarteira$TOTAL.OP), FUN=length)
dfCarteira1[dfCarteira1$ACAO == "HABT11",]
View(agg_ACAO)
# agregar por ação ...
# Group by count using R Base aggregate()
agg_ACAO <- aggregate(dfCarteira$ACAO, dfCarteira$QTDE, dfCarteira$TOTAL.OP,
by=list(dfCarteira$ACAO), FUN=length)
agg_ACAO <- aggregate(dfCarteira$ACAO,
by=list(dfCarteira$ACAO, dfCarteira$QTDE, dfCarteira$TOTAL.OP), FUN=length)
dfCarteira2 <- dfCarteira1 %>%
group_by(ACAO) %>%
summarise(across(c(QTDE, TOTAL.OP), sum))
dfCarteira1 <- select(dfCarteira, 'ACAO','QTDE','TOTAL.OP' )
dfCarteira1$TOTAL.OP <- virgulaToValor(dfCarteira1$TOTAL.OP)
View(dfCarteira1)
library(dplyr)
dfCarteira2 <- dfCarteira1 %>%
group_by(ACAO) %>%
summarise(across(c(QTDE, TOTAL.OP), sum))
View(dfCarteira2)
dfCarteira2[dfCarteira2$ACAO == "VSLH11",]
# Valor Atual da VSLH11
View(tbls_datafe[tbls_datafe$Fundos == "VSLH11",])
tbls_backup <- tbls_datafe
# preço atual da VSLH11
tbls_datafe %>%
filter(Fundos == "VSLH11") %>%
select_at(vars(`Preço Atual (R$)`))
totalGeral <- sum(dfCarteira2$TOTAL.OP)
totalGeral
# Percentual das ações por valor
dfCarteira2 <- dfCarteira2 %>%
mutate(percent = (TOTAL.OP/totalGeral)*100)
sum(dfCarteira2$percent)
dfCarteira2
pie(dfCarteira2)
legenda <- paste(row.names(dfCarteira2$ACAO), dfCarteira2$percent)
legenda
legenda <- paste(row.names(dfCarteira2), dfCarteira2$percent)
legenda
legenda <- paste(dfCarteira2$ACAO, dfCarteira2$percent)
legenda
pie( x = dfCarteira2$percent,
labels = legenda,
main = "CARTEIRA")
options(scipen=100, digits = 3)
legenda <- paste(dfCarteira2$ACAO, dfCarteira2$percent)
legenda
#options(scipen=100, digits = 3)
options(digits = 3)
legenda <- paste(dfCarteira2$ACAO, dfCarteira2$percent)
legenda
pie( x = dfCarteira2$percent,
labels = legenda,
main = "CARTEIRA")
#options(scipen=100, digits = 3)
options(digits = 3)
legenda <- paste(dfCarteira2$ACAO, dfCarteira2$percent)
legenda
# Utilizando dados do TCC ...
pacotes <- c("seleniumPipes","RSelenium","rvest","openxlsx","XML",
"dplyr","kableExtra","scales")
if(sum(as.numeric(!pacotes %in% installed.packages())) != 0){
instalador <- pacotes[!pacotes %in% installed.packages()]
for(i in 1:length(instalador)) {
install.packages(instalador, dependencies = T)
break()}
sapply(pacotes, require, character = T)
} else {
sapply(pacotes, require, character = T)
}
legenda <- paste(dfCarteira2$ACAO, label_percent()(dfCarteira2$percent))
legenda
legenda <- paste(dfCarteira2$ACAO, label_percent(big.mark = ".")(dfCarteira2$percent))
legenda <- paste(dfCarteira2$ACAO, label_percent()(dfCarteira2$percent))
legenda
#options(scipen=100, digits = 3)
options(digits = 3)
legenda <- paste(dfCarteira2$ACAO, label_percent()(dfCarteira2$percent))
legenda
legenda <- paste(dfCarteira2$ACAO, percent(dfCarteira2$percent))
legenda
specify_decimal <- function(x, k) {
trimws(format(round(x, k), nsmall=k))
}
legenda <- paste(dfCarteira2$ACAO, specify_decimal(dfCarteira2$percent,2))
legenda
pie( x = dfCarteira2$percent,
labels = legenda,
main = "CARTEIRA")
pie( x = dfCarteira2$percent,
labels = legenda,
main = "CARTEIRA",
lty = 2)
# Donut chart por Setor
#library(lessR)
PieChart(ACAO, y=percent, data = dfCarteira2,
values_digits=2,
main = NULL)
# Donut chart por Setor
library(lessR)
PieChart(ACAO, y=percent, data = dfCarteira2,
values_digits=2,
main = NULL)
dfAcaoSetor <- select(tbls_datafe, tbls_datafe$Fundos, tbls_datafe$Setor)
? select
dfAcaoSetor <- select(tbls_datafe, 'Fundos', 'Setor')
View(dfAcaoSetor)
dfCarteiraBKP <- dfCarteira2
View(dfCarteira2)
dfCarteira2$Setor[match(tbls_datafe$Fundos,
dfCarteira2$ACAO)] <- tbls_datafe$Setor
tbls_datafe <- tbls_datafe[!is.na(tbls_datafe$Setor),]
dfCarteira2$Setor[match(tbls_datafe$Fundos,
dfCarteira2$ACAO)] <- tbls_datafe$Setor
tbls_datafe <- tbls_datafe[!is.na(tbls_datafe$Fundos),]
dfCarteira2$Setor[match(tbls_datafe$Fundos,
dfCarteira2$ACAO)] <- tbls_datafe$Setor
dfCarteira2 <- dfCarteira2[!is.na(dfCarteira2$ACAO),]
dfCarteira2$Setor[match(tbls_datafe$Fundos,
dfCarteira2$ACAO)] <- tbls_datafe$Setor
#tbls_datafe
dfCarteira2$Setor <- tbls_datafe[tbls_datafe$Fundos %in% dfCarteira2$ACAO,'Setor']
View(dfCarteira2)
PieChart(Setor, y=percent, data = dfCarteira2,
values_digits=2,
main = NULL)
View(dfCarteira2)
#tbls_datafe
dfCarteira2$Setor <- tbls_datafe$Setor[tbls_datafe$Fundos %in% dfCarteira2$ACAO,'Setor']
#tbls_datafe
dfCarteira2$Setor <- tbls_datafe[tbls_datafe$Fundos %in% dfCarteira2$ACAO]$Setor
View(dfCarteira2)
dfCarteira2$Setor2 <- dfAcaoSetor[tbls_datafe$Fundos %in% dfCarteira2$ACAO]
dfCarteira2$Setor2 <- dfAcaoSetor[tbls_datafe$Fundos %in% dfCarteira2$ACAO,1]
View(dfCarteira2)
dfCarteira2$Setor2 <- dfAcaoSetor[tbls_datafe$Fundos %in% dfCarteira2$ACAO,2]
View(dfCarteira2)
PieChart(Setor$Setor, y=percent, data = dfCarteira2,
values_digits=2,
main = NULL)
agg_Setor <- aggregate(dfCarteira2$Setor, dfCarteira2$percent,
by=list(dfCarteira$Setor), FUN=length)
agg_Setor <- aggregate(dfCarteira2$Setor, dfCarteira2$percent
by=list(dfCarteira$Setor), FUN=length)
View(agg_ACAO)
View(dfCarteira2)
? aggregate
dfCarteiraSetor <- dfCarteira2 %>%
group_by(Setor) %>%
summarise(across(c(QTDE, TOTAL.OP), sum))
View(dfCarteiraSetor)
dfCarteiraSetor <- dfCarteira2 %>%
group_by(Setor) %>%
summarise(across(c(QTDE, TOTAL.OP), sum)) %>%
mutate(percent = (TOTAL.OP/totalGeral)*100)
View(dfCarteiraSetor)
sum(dfCarteiraSetor$percent)
sum(dfCarteiraSetor$TOTAL.OP)
PieChart(Setor$Setor, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
PieChart(Setor, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
View(dfCarteiraSetor)
PieChart(Setor$Setor, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
PieChart(Setor, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
View(dfCarteiraSetor)
names(dfCarteiraSetor)[names(dfCarteiraSetor) == "Setor$Setor"] <- "Setor"
View(dfCarteiraSetor)
#names(dfCarteiraSetor)[names(dfCarteiraSetor) == "Setor$Setor"] <- "Setor"
colnames(dfCarteiraSetor)[1] ="Setor"
View(dfCarteiraSetor)
#names(dfCarteiraSetor)[names(dfCarteiraSetor) == "Setor$Setor"] <- "Setor"
colnames(dfCarteiraSetor)[1]
PieChart(Setor, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
PieChart(x = Setor, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
PieChart(x = 1, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
PieChart(x = Setor, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
dfCarteiraSetor <- dfCarteiraSetor %>%
rename("Setor$Setor" = "setor")
dfCarteiraSetor <- dfCarteiraSetor %>%
rename("Setor" = "novosetor")
dfCarteiraSetor <- dfCarteiraSetor %>%
rename("Setor" = "novosetor")
library("dplyr")
dfCarteiraSetor <- dfCarteiraSetor %>%
rename("Setor" = "novosetor")
dfCarteiraSetor <- dfCarteiraSetor %>%
dplyr::rename("Setor" = "novosetor")
dfCarteiraSetor <- dfCarteiraSetor %>%
plyr::rename("Setor" = "novosetor")
View(dfCarteiraSetor)
colnames(dfCarteiraSetor) <- c("sector", "qtde", "totalop", "percent")
View(dfCarteiraSetor)
colnames(dfCarteiraSetor) <- c("sector", "qtde", "totalop", "percent")
View(dfCarteiraSetor)
dfCarteiraSetor
PieChart(x = Setor, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
PieChart(x = sector, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
PieChart(x = sector, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
View(dfCarteiraSetor)
View(dfCarteira2)
View(dfCarteira2)
dfCarteira2 <- dfCarteiraBKP
dfCarteira2 <- dfCarteira2 %>%
mutate(Setor = dfAcaoSetor[tbls_datafe$Fundos %in% dfCarteira2$ACAO,2])
View(dfCarteira2)
dfCarteira2 <- dfCarteiraBKP
dfCarteira2 <- dfCarteira2 %>%
mutate(Setor = dfAcaoSetor[tbls_datafe$Fundos %in% dfCarteira2$ACAO,])
View(dfCarteira2)
dfCarteira2 <- dfCarteiraBKP
dfCarteira2 <- dfCarteira2 %>%
mutate(Setor = dfAcaoSetor[tbls_datafe$Fundos %in% dfCarteira2$ACAO,2])
View(dfCarteira2)
dfCarteira2 <- dfCarteiraBKP
dfCarteira2 <- dfCarteira2 %>%
mutate(dfAcaoSetor[tbls_datafe$Fundos %in% dfCarteira2$ACAO,2])
View(dfCarteira2)
dfCarteiraSetor <- dfCarteira2 %>%
group_by(Setor) %>%
summarise(across(c(QTDE, TOTAL.OP), sum)) %>%
mutate(percent = (TOTAL.OP/totalGeral)*100)
View(dfCarteiraSetor)
PieChart(x = sector, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
PieChart(x = Setor, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
View(dfCarteira2)
# Carregar DE-PARA
csvPath <- tccPath + 'FII-SETOR-DE_PARA.csv'
#----
tccPath = "C://BISTERCO//MBA//TCC//"
# Carregar DE-PARA
csvPath <- tccPath + 'FII-SETOR-DE_PARA.csv'
# Carregar DE-PARA
csvPath <- paste(tccPath,'FII-SETOR-DE_PARA.csv')
#dfSetorDeParaA <- read.df(csvPath, "csv", header = "true", inferSchema = "true", na.strings = "NA")
dfSetorDePara <- read.csv(csvPath)
# Carregar DE-PARA
csvPath <- paste(tccPath,'FII-SETOR-DE_PARA.csv', sep="")
#dfSetorDeParaA <- read.df(csvPath, "csv", header = "true", inferSchema = "true", na.strings = "NA")
dfSetorDePara <- read.csv(csvPath)
View(dfSetorDePara)
View(dfSetorDePara)
dfCarteira2 <- dfCarteira2 %>%
# tbls_datafe %>%
left_join(., dfSetorDePara, by= "Fundos") %>%
mutate(Setor = ifelse(!is.na(SetorNew), SetorNew, Setor)) %>%
select(-SetorNew)
View(dfCarteira2)
dfCarteira2 <- dfCarteira2 %>%
# tbls_datafe %>%
left_join(., dfSetorDePara, by= "ACAO = Fundos") %>%
mutate(Setor = ifelse(!is.na(SetorNew), SetorNew, Setor)) %>%
select(-SetorNew)
dfCarteira2 <- dfCarteira2 %>%
# tbls_datafe %>%
left_join(., dfSetorDePara, by=c('ACAO'='Fundos')) %>%
mutate(Setor = ifelse(!is.na(SetorNew), SetorNew, Setor)) %>%
select(-SetorNew)
View(dfCarteira2)
dfCarteiraSetor <- dfCarteira2 %>%
group_by(Setor) %>%
summarise(across(c(QTDE, TOTAL.OP), sum)) %>%
mutate(percent = (TOTAL.OP/totalGeral)*100)
sum(dfCarteiraSetor$percent)
sum(dfCarteiraSetor$TOTAL.OP)
PieChart(x = Setor, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
View(dfCarteira2)
PieChart(ACAO, y=percent, data = dfCarteira2,
values_digits=2,
main = NULL)
# funcionou - grafico pizza por setor
PieChart(x = Setor, y=percent, data = dfCarteiraSetor,
values_digits=2,
main = NULL)
sum(dfCarteiraSetor$percent)
# dfCarteira2 ficou como base ...
dfCarteira2
# dfCarteira2 ficou como base ...
View(dfCarteira2)
View(dfSetorDePara)
View(tbls_datafe)
View(tbls_datafe)
## VALOR PAGO X VALOR ATUAL - INICIO -----
head(tbls_datafe)
dfAcaoValor <- select(tbls_datafe, 'Fundos', 'Preço Atual (R$))
dfAcaoValor <- select(tbls_datafe, 'Fundos', 'Preço Atual (R$))')
dfAcaoValor <- select(tbls_datafe, "Fundos', 'Preço Atual (R$)')
dfAcaoValor <- select(tbls_datafe, 'Fundos', `Preço Atual (R$)`)
View(dfAcaoValor)
dfAcaoValor <- select(tbls_datafe, 'Fundos', `Preço Atual (R$)`)
View(dfAcaoValor)
.
]
;;;
;
...
quit
q
dfAcaoValor <- select(tbls_datafe, 'Fundos', `Preço Atual (R$)`)
View(dfAcaoValor)
dfAcaoValor <- dfAcaoValor[!is.na(dfAcaoValor$`Preço Atual (R$)`),]
dfAcaoValor <- dfAcaoValor[dfAcaoValor$`Preço Atual (R$)` != "N/A",]
View(dfAcaoValor)
dfCarteira1$precoAtual <- virgulaToValor(dfAcaoValor$`Preço Atual (R$)`)
dfAcaoValor$precoAtual <- virgulaToValor(dfAcaoValor$`Preço Atual (R$)`)
View(dfAcaoValor)
